#!/bin/bash

[ -z "$DEBUG" ] || set -x

apiserver="https://master.cfcr.internal:8443"
ca_cert=/var/vcap/jobs/kube-apiserver/config/kubernetes.pem
admin_cert=/var/vcap/jobs/kube-apiserver/config/admin-user-cert.pem
admin_key=/var/vcap/jobs/kube-apiserver/config/admin-user-key.pem

interval="2"

until $(curl --fail -s -o /dev/null ${apiserver}/healthz --cacert ${ca_cert} --cert ${admin_cert} --key ${admin_key}); do
  sleep $interval
done
